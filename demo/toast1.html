<!-- 🔔 Enhanced Toast Notification System -->
<!-- 
✅ Features:
- Better mobile responsiveness
- Improved animations
- RTL language support
- Accessibility improvements
- Customizable positions
- Queue management
- Progress indicator
- Dynamic icon support
- Better theme integration
-->

<!-- 📦 Toast Container -->
<div id="toast-container" class="toast-top-center"></div>

<!-- � Toast Backdrop (for important notifications) -->
<div id="toast-backdrop" class="toast-backdrop" style="display: none;"></div>

<!-- 🧩 Toast Templates (Hidden) -->
<div id="toast-sample" style="display: none;">
  <!-- Base Toast Template -->
  <div class="toast">
    <div class="toast-content">
      <i class="toast-icon"></i>
      <div class="toast-message">
        <span class="toast-title"></span>
        <span class="toast-text"></span>
      </div>
    </div>
    <button class="toast-close-btn" aria-label="Close">&times;</button>
    <div class="toast-progress"></div>
  </div>
</div>

<!-- 🧠 Enhanced Toast Styles -->
<style>
  /* === CSS Variables for Theming === */
  :root {
    /* Colors */
    --toast-bg: #ffffff;
    --toast-text: #333333;
    --toast-shadow: rgba(0, 0, 0, 0.15);
    --toast-border-radius: 8px;
    --toast-spacing: 12px;
    
    /* Animations */
    --toast-animation-duration: 0.4s;
    
    /* Sizes */
    --toast-width: 300px;
    --toast-min-height: 60px;
    --toast-icon-size: 20px;
    --toast-font-size: 14px;
    --toast-title-size: 16px;
    
    /* Positions */
    --toast-offset: 20px;
  }

  .dark-mode {
    --toast-bg: #2d3748;
    --toast-text: #f7fafc;
    --toast-shadow: rgba(0, 0, 0, 0.3);
  }

  /* === Toast Container === */
  #toast-container {
    position: fixed;
    z-index: 9999;
    display: flex;
    
    flex-direction: column;
    gap: var(--toast-spacing);
    pointer-events: none;
  }

  /* Container Position Classes */
  .toast-top-center {
    top: var(--toast-offset);
    left: 50%;
    transform: translateX(-50%);
    align-items: center;
  }
  
  .toast-top-left {
    top: var(--toast-offset);
    left: var(--toast-offset);
    align-items: flex-start;
  }
  
  .toast-top-right {
    top: var(--toast-offset);
    right: var(--toast-offset);
    align-items: flex-end;
  }
  
  .toast-bottom-center {
    bottom: var(--toast-offset);
    left: 50%;
    transform: translateX(-50%);
    align-items: center;
  }
  
  .toast-bottom-left {
    bottom: var(--toast-offset);
    left: var(--toast-offset);
    align-items: flex-start;
  }
  
  .toast-bottom-right {
    bottom: var(--toast-offset);
    right: var(--toast-offset);
    align-items: flex-end;
  }

  /* === Toast Backdrop === */
  .toast-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9998;
    display: none;
  }

  /* === Toast Element === */
  .toast {
    position: relative;
    width: var(--toast-width);
    min-height: var(--toast-min-height);
    padding: 16px;
    border-radius: var(--toast-border-radius);
    background-color: var(--toast-bg);
    box-shadow: 0 4px 12px var(--toast-shadow);
    color: var(--toast-text);
    display: flex;
    justify-content: space-between;
    align-items: center;
    overflow: hidden;
    pointer-events: auto;
    transition: all var(--toast-animation-duration) ease;
    opacity: 0;
    transform: translateY(-20px);
  }

  .toast.show {
    opacity: 1;
    transform: translateY(0);
  }

  .toast.hide {
    opacity: 0;
    transform: translateY(-20px);
  }

  /* Toast Content */
  .toast-content {
    display: flex;
    align-items: center;
    gap: 12px;  
    flex-grow: 1;
    min-width: 0;
  }

  .toast-icon {
    font-size: var(--toast-icon-size);
    flex-shrink: 0;
  }

  .toast-message {
    display: flex;
    flex-direction: column;
    min-width: 0;
    flex-grow: 1;
  }

  .toast-title {
    font-size: var(--toast-title-size);
    font-weight: 600;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .toast-text {
    font-size: var(--toast-font-size);
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* Close Button */
  .toast-close-btn {
    background: none;
    border: none;
    font-size: 18px;
    color: inherit;
    opacity: 0.7;
    cursor: pointer;
    padding: 4px;
    margin-left: 8px;
    line-height: 1;
    transition: opacity 0.2s ease;
    flex-shrink: 0;
  }

  .toast-close-btn:hover {
    opacity: 1;
  }

  /* Progress Bar */
  .toast-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 4px;
    width: 100%;
    background-color: rgba(255, 255, 255, 0.3);
    transform-origin: left;
    transform: scaleX(1);
  }

  .toast-progress.animate {
    animation: progress linear forwards;
  }

  @keyframes progress {
    to {
      transform: scaleX(0);
    }
  }

  /* === Toast Types === */
  .toast-success {
    border-left: 4px solid var(--success);
  }
  
  .toast-error {
    border-left: 4px solid var(--error);
  }
  
  .toast-info {
    border-left: 4px solid var(--info);
  }
  
  .toast-warning {
    border-left: 4px solid var(--warning);
  }
  
  .toast-loading {
    border-left: 4px solid var(--loading);
  }
  
  .toast-system {
    border-left: 4px solid var(--system);
  }
  
  .toast-custom {
    border-left: 4px solid var(--custom);
  }
  
  .toast-cart {
    border-left: 4px solid var(--cart);
  }
  
  .toast-save {
    border-left: 4px solid var(--save);
  }
  
  .toast-login {
    border-left: 4px solid var(--login);
  }
  
  .toast-account {
    border-left: 4px solid var(--account);
  }
  
  .toast-logout {
    border-left: 4px solid var(--logout);
  }
  
  .toast-feedback {
    border-left: 4px solid var(--feedback);
  }
  
  .toast-role-switch {
    border-left: 4px solid var(--role-switch);
  }
  
  .toast-saved {
    border-left: 4px solid var(--saved);
  }
  
  .toast-removed {
    border-left: 4px solid var(--removed);
  }
  
  .toast-offline {
    border-left: 4px solid var(--offline);
  }
  
  .toast-clipboard {
    border-left: 4px solid var(--clipboard);
  }

  /* === Responsive Design === */
  @media (max-width: 600px) {
    :root {
      --toast-width: calc(100vw - 40px);
      --toast-offset: 10px;
    }
    
    #toast-container {
      width: 100%;
      padding: 0 20px;
      box-sizing: border-box;
    }
    
    .toast-top-center,
    .toast-bottom-center {
      left: 0;
      right: 0;
      transform: none;
    }
  }

  /* === RTL Support === */
  [dir="rtl"] .toast {
    border-left: none;
    border-right: 4px solid;
  }
  
  [dir="rtl"] .toast-progress {
    transform-origin: right;
    right: 0;
    left: auto;
  }
  
  [dir="rtl"] .toast-close-btn {
    margin-left: 0;
    margin-right: 8px;
  }
</style>

<!-- ⚙️ Enhanced Toast Logic -->
<script>
  (function() {
    'use strict';
    
    // Toast queue for managing multiple toasts
    const toastQueue = [];
    let isProcessingQueue = false;
    
    // DOM elements
    const container = document.getElementById('toast-container');
    const backdrop = document.getElementById('toast-backdrop');
    const sample = document.getElementById('toast-sample');
    
    if (!container || !sample) return;
    
    // Default configuration
    const defaults = {
      position: 'top-center',
      duration: 5000,
      dismissible: true,
      progress: true,
      backdrop: false,
      queue: true,
      animate: true
    };
    
    // Toast type icons (using Font Awesome classes)
    const icons = {
      success: 'fas fa-check-circle',
      error: 'fas fa-times-circle',
      info: 'fas fa-info-circle',
      warning: 'fas fa-exclamation-triangle',
      loading: 'fas fa-spinner fa-spin',
      system: 'fas fa-desktop',
      custom: 'fas fa-star',
      cart: 'fas fa-cart-plus',
      save: 'fas fa-save',
      login: 'fas fa-sign-in-alt',
      account: 'fas fa-user-circle',
      logout: 'fas fa-sign-out-alt',
      feedback: 'fas fa-comment-alt',
      'role-switch': 'fas fa-exchange-alt',
      saved: 'fas fa-heart',
      removed: 'fas fa-trash-alt',
      offline: 'fas fa-unlink',
      clipboard: 'fas fa-copy'
    };
    
    /**
     * Shows a toast notification
     * @param {string|object} options - Either the message or an options object
     * @param {string} [type='info'] - Type of toast (only if first param is message)
     * @return {object} Toast instance with dismiss method
     */
    function showToast(options, type = 'info') {
      // Handle different parameter formats
      const params = typeof options === 'string' ? {
        message: options,
        type: type
      } : options;
      
      // Merge with defaults
      const config = {...defaults, ...params};
      
      // Create toast element
      const toast = createToast(config);
      
      // Add to queue or show immediately
      if (config.queue && toastQueue.length > 0) {
        toastQueue.push({toast, config});
        if (!isProcessingQueue) processQueue();
        return toast;
      }
      
      // Show the toast
      displayToast(toast, config);
      
      return toast;
    }
    
    /**
     * Creates a toast DOM element
     * @param {object} config - Toast configuration
     * @return {HTMLElement} Toast element
     */
    function createToast(config) {
      const toast = sample.querySelector('.toast').cloneNode(true);
      const content = toast.querySelector('.toast-content');
      const icon = toast.querySelector('.toast-icon');
      const title = toast.querySelector('.toast-title');
      const text = toast.querySelector('.toast-text');
      const closeBtn = toast.querySelector('.toast-close-btn');
      const progress = toast.querySelector('.toast-progress');
      
      // Set toast type class
      toast.classList.add(`toast-${config.type}`);
      
      // Set icon
      if (config.icon) {
        icon.className = `toast-icon ${config.icon}`;
      } else if (icons[config.type]) {
        icon.className = `toast-icon ${icons[config.type]}`;
      } else {
        icon.remove();
      }
      
      // Set title and text
      if (config.title) {
        title.textContent = config.title;
      } else {
        title.remove();
      }
      
      text.textContent = config.message;
      
      // Set close button
      if (!config.dismissible) {
        closeBtn.remove();
      }
      
      // Set progress bar
      if (!config.progress || config.duration <= 0) {
        progress.remove();
      }
      
      return toast;
    }
    
    /**
     * Displays a toast with animation
     * @param {HTMLElement} toast - Toast element
     * @param {object} config - Toast configuration
     */
    function displayToast(toast, config) {
      // Set container position
      container.className = `toast-${config.position.replace(' ', '-').toLowerCase()}`;
      
      // Show backdrop if needed
      if (config.backdrop) {
        backdrop.style.display = 'block';
      }
      
      // Add toast to container
      container.appendChild(toast);
      
      // Force reflow to enable animation
      void toast.offsetHeight;
      
      // Show toast with animation
      toast.classList.add('show');
      
      // Start progress bar animation
      const progress = toast.querySelector('.toast-progress');
      if (progress && config.duration > 0) {
        progress.style.animationDuration = `${config.duration}ms`;
        progress.classList.add('animate');
      }
      
      // Set up auto-dismiss
      let timeoutId;
      if (config.duration > 0) {
        timeoutId = setTimeout(() => dismissToast(toast, config), config.duration);
      }
      
      // Set up close button
      const closeBtn = toast.querySelector('.toast-close-btn');
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          clearTimeout(timeoutId);
          dismissToast(toast, config);
        });
      }
      
      // Pause on hover
      toast.addEventListener('mouseenter', () => {
        if (timeoutId) clearTimeout(timeoutId);
        if (progress) progress.style.animationPlayState = 'paused';
      });
      
      toast.addEventListener('mouseleave', () => {
        if (config.duration > 0) {
          const remaining = getRemainingDuration(progress);
          if (remaining > 0) {
            timeoutId = setTimeout(() => dismissToast(toast, config), remaining);
            if (progress) {
              progress.style.animationPlayState = 'running';
              progress.style.animationDuration = `${remaining}ms`;
            }
          }
        }
      });
      
      // Add dismiss method to toast element
      toast.dismiss = () => {
        clearTimeout(timeoutId);
        dismissToast(toast, config);
      };
    }
    
    /**
     * Dismisses a toast with animation
     * @param {HTMLElement} toast - Toast element
     * @param {object} config - Toast configuration
     */
    function dismissToast(toast, config) {
      if (!toast || !toast.parentNode) return;
      
      toast.classList.remove('show');
      toast.classList.add('hide');
      
      // Remove backdrop if no more toasts with backdrop
      if (config.backdrop) {
        const hasBackdropToast = Array.from(container.children).some(
          t => t.getAttribute('data-backdrop') === 'true'
        );
        if (!hasBackdropToast) {
          backdrop.style.display = 'none';
        }
      }
      
      // Remove after animation
      setTimeout(() => {
        toast.remove();
        if (toastQueue.length > 0) processQueue();
      }, parseFloat(getComputedStyle(toast).transitionDuration) * 1000 || 400);
    }
    
    /**
     * Processes the toast queue
     */
    function processQueue() {
      if (toastQueue.length === 0 || isProcessingQueue) return;
      
      isProcessingQueue = true;
      const {toast, config} = toastQueue.shift();
      
      displayToast(toast, config);
      
      // Wait for toast to be dismissed before showing next
      const checkDismissed = setInterval(() => {
        if (!document.body.contains(toast)) {
          clearInterval(checkDismissed);
          isProcessingQueue = false;
          if (toastQueue.length > 0) processQueue();
        }
      }, 100);
    }
    
    /**
     * Gets remaining duration from progress bar
     * @param {HTMLElement} progress - Progress bar element
     * @return {number} Remaining duration in ms
     */
    function getRemainingDuration(progress) {
      if (!progress) return 0;
      
      const style = getComputedStyle(progress);
      const scale = style.transform === 'none' ? 1 : parseFloat(style.transform.split(',')[0].split('(')[1]);
      const duration = parseFloat(style.animationDuration) * scale;
      
      return duration;
    }
    
    // Expose to global scope
    window.Toast = {
      show: showToast,
      
      // Shortcut methods
      success: (message, options) => showToast({...options, message, type: 'success'}),
      error: (message, options) => showToast({...options, message, type: 'error'}),
      info: (message, options) => showToast({...options, message, type: 'info'}),
      warning: (message, options) => showToast({...options, message, type: 'warning'}),
      loading: (message, options) => showToast({...options, message, type: 'loading'}),
      
      // Configuration
      setDefaults: (newDefaults) => {
        Object.assign(defaults, newDefaults);
      },
      
      // Clear all toasts
      clearAll: () => {
        Array.from(container.children).forEach(toast => {
          if (toast.dismiss) toast.dismiss();
        });
        toastQueue.length = 0;
        backdrop.style.display = 'none';
      }
    };
    
    // Auto-initialize with demo if enabled
    if (window.location.search.includes('demo=toast')) {
      window.addEventListener('load', () => {
        setTimeout(() => Toast.success('Success! Operation completed.'), 300);
        setTimeout(() => Toast.error('Error! Something went wrong.'), 800);
        setTimeout(() => Toast.info('Information message for you.'), 1300);
        setTimeout(() => Toast.warning('Warning: Be careful!'), 1800);
      });
    }
  })();
  /**
 * @file Toast Notification Module
 * Provides a self-contained, modular function to display toast notifications.
 * This module creates its own container and manages toast elements dynamically.
 */

// --- Toast Configuration ---
const toastConfig = {
    // Default messages for common actions
    login: { message: 'Logged in successfully!', icon: 'fas fa-check-circle', type: 'success' },
    logout: { message: 'Logged out successfully.', icon: 'fas fa-info-circle', type: 'info' },
    account: { message: 'Account created successfully!', icon: 'fas fa-user-plus', type: 'success' },
    // Default settings
    defaultDuration: 4000,
    containerId: 'toast-container-main'
};

// --- Private Helper Functions ---

/**
 * Ensures the toast container element exists in the DOM.
 * If not, it creates and appends it to the body.
 * @returns {HTMLElement} The toast container element.
 */
function getOrCreateContainer() {
    let container = document.getElementById(toastConfig.containerId);
    if (!container) {
        container = document.createElement('div');
        container.id = toastConfig.containerId;
        // Add styles for the container
        container.style.position = 'fixed';
        container.style.top = '20px';
        container.style.right = '20px';
        container.style.zIndex = '99999';
        container.style.display = 'flex';
        container.style.flexDirection = 'column';
        container.style.gap = '10px';
        document.body.appendChild(container);
    }
    return container;
}

/**
 * Creates a single toast element.
 * @param {string} message - The message to display.
 * @param {string} icon - The Font Awesome icon class.
 * @param {string} type - The type of toast (e.g., 'success', 'error', 'info').
 * @returns {HTMLElement} The created toast element.
 */
function createToastElement(message, icon, type) {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    
    // Basic styling (can be moved to a CSS file if it gets complex)
    toast.style.display = 'flex';
    toast.style.alignItems = 'center';
    toast.style.padding = '12px 16px';
    toast.style.backgroundColor = 'var(--bg-secondary, #fff)';
    toast.style.color = 'var(--text-primary, #333)';
    toast.style.borderRadius = '8px';
    toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
    toast.style.borderLeft = `4px solid var(--toast-${type}-color, #ccc)`;
    toast.style.gap = '10px';
    toast.style.fontFamily = 'sans-serif';
    toast.style.fontSize = '0.9rem';
    toast.style.animation = 'toast-fade-in 0.3s ease-out';

    // Set colors based on type
    const colors = {
        success: 'var(--accent-success, #28a745)',
        error: 'var(--accent-danger, #dc3545)',
        info: 'var(--accent-info, #17a2b8)',
        warning: 'var(--accent-warning, #ffc107)'
    };
    toast.style.borderLeftColor = colors[type] || '#6c757d';

    toast.innerHTML = `
        <i class="${icon}" style="font-size: 1.2rem; color: ${colors[type] || '#6c757d'};"></i>
        <span class="toast-message">${message}</span>
    `;

    // Add keyframe animation dynamically
    if (!document.getElementById('toast-animations')) {
        const styleSheet = document.createElement("style");
        styleSheet.id = 'toast-animations';
        styleSheet.innerText = `
            @keyframes toast-fade-in {
                from { opacity: 0; transform: translateX(100%); }
                to { opacity: 1; transform: translateX(0); }
            }
            @keyframes toast-fade-out {
                from { opacity: 1; transform: translateX(0); }
                to { opacity: 0; transform: translateX(100%); }
            }
        `;
        document.head.appendChild(styleSheet);
    }

    return toast;
}


// --- Public Exported Function ---

/**
 * Displays a toast notification.
 * @param {string} type - The type of toast. Can be a preset key ('login', 'logout', 'account') or a custom type ('success', 'error', 'info', 'warning').
 * @param {string} [message] - A custom message. If provided, it overrides the preset message.
 * @param {number} [duration=4000] - The duration in milliseconds for the toast to be visible.
 */
export function showToast(type, message, duration) {
    const preset = toastConfig[type];
    const finalMessage = message || preset?.message || 'Notification';
    const finalIcon = preset?.icon || (type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-info-circle');
    const finalType = preset?.type || type;
    const finalDuration = duration || toastConfig.defaultDuration;

    const container = getOrCreateContainer();
    const toastElement = createToastElement(finalMessage, finalIcon, finalType);

    container.appendChild(toastElement);

    setTimeout(() => {
        toastElement.style.animation = 'toast-fade-out 0.3s ease-in forwards';
        // Remove the element after the animation completes
        toastElement.addEventListener('animationend', () => {
            toastElement.remove();
        });
    }, finalDuration);
}
</script>